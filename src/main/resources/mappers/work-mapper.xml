<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="workMapper">

	<resultMap id="holidayResult1" type="Holiday">
		<id column="holiday_no" property="holidayNo" />
		<result column="user_no" property="userNo" />
		<result column ="user_name" property="userName" />
		<result column ="h_type" property="type" />
		<result column ="h_sort" property="sort" />
		<result column ="h_start" property="start" />
		<result column ="h_finish" property="finish" />
		<result column ="h_date" property="datea" />
		<result column ="h_reason" property="reason" />
		<result column ="status" property="status" />
	</resultMap>
	
	<resultMap id="holidayResult2" type="Member">
		<id column="user_no" property="userNo" />
		<result column ="user_name" property="userName" />
		<result column ="give_day" property="giveDay" />
		<result column ="use_day" property="useDay" />
		<result column ="add_day" property="addDay" />
		
	</resultMap>

	<select id="selectHolidayList" resultMap="holidayResult2" >
		SELECT T1.USER_NO 
		     , T1.USER_NAME
		     , SUM ( CASE WHEN T2.H_CAUSE = '연차지급' THEN T2.H_GIVE ELSE 0 END ) AS GIVE_DAY
		     , SUM ( CASE WHEN T2.H_CAUSE = '연차사용' THEN T2.H_GIVE ELSE 0 END ) AS USE_DAY
		     , SUM ( CASE WHEN T2.H_CAUSE = '추가지급' THEN T2.H_GIVE ELSE 0 END ) AS ADD_DAY
		  FROM MEMBER T1
		  LEFT OUTER JOIN HOLIDAY T2  
		    ON T1.USER_NO = T2.USER_NO
		 GROUP BY T1.USER_NO  
		       , T1.USER_NAME 
		 ORDER BY T1.USER_NO ASC
	</select>
	
	<select id="selectHolidayUseList" resultMap="holidayResult1" >
		SELECT 
		       HOLIDAY_NO
		     , H.USER_NO
		     , USER_NAME
		     , H_TYPE
		     , H_SORT
		     , H_START
		     , H_FINISH
		     , H_DATE
		     , H_REASON
		     , H.STATUS
		  FROM HOLIDAY_APPLY H
		  join member on (member.user_no = h.user_no)
	</select>
	
	<select id="selectBeforeUseList" resultMap="holidayResult1" >
		select 
		       holiday_no
		     , T1.user_no
		     , user_name
		     , h_type
		     , h_sort
		     , h_start
		     , h_finish
		     , h_date
		     , h_reason
		     , T1.status
		  from holiday_apply T1
		  join member T2 on (T1.user_no = T2.user_no)
		 where T1.status='승인대기'
	</select>
	
	<insert id="completeWorkInsert">
		Insert into work (work_no, user_no, work_date, work_in, work_out, work_time, status )
			     select seq_wno.nextval, m.user_no,to_date(sysdate,'YYYY-MM-DD hh24:mi:SS'),null, null, null, '결근'
			     from member m
			     where m.status ='Y'
	</insert>
</mapper>